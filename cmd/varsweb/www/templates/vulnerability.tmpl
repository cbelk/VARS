{% raw %}

// Display vulnerabilities
{{define "vulns"}}
{{template "header"}}
{{template "navbar" .U}}
{{if .U.Authed}}
<div class="container-fluid pt-3 pb-3 pl-5 pr-5">
    <div class="table-responsive">
    <table class="table table-striped table-dark table-bordered table-hover">
        <thead>
            <tr>
                <th scope="col" class="col-2">Name</th>
                <th scope="col" class="col-4">Summary</th>
                <th scope="col" class="col-1">CVSS</th>
                <th scope="col" class="col-1">Corporate Risk Score</th>
                <th scope="col" class="col-2">Date Opened</th>
                <th scope="col" class="col-2">Date Closed</th>
            </tr>
        </thead>
        <tbody>
        {{range .Vulns}}
            <tr data-toggle="modal" data-target="#vuln-modal" data-vid={{.ID}}>
                <td>{{.Name}}</td>
                <td>{{.Summary}}</td>
                <td>{{.Cvss}}</td>
                <td>{{.CorpScore}}</td>
                <td>{{.Dates.Initiated}}</td>
                {{if .Dates.Mitigated.Valid}}
                <td>{{.Dates.Mitigated.Time}}</td>
                {{else}}
                <td></td>
                {{end}}
            </tr>
        {{end}}
        </tbody>
    </table>
    </div>
</div>
{{template "vuln-modal" .U}}
{{end}}
{{template "footer"}}
{{end}}

// Vulnerability Modal
{{define "vuln-modal"}}
<div class="modal fade" id="vuln-modal" tabindex="-1" role="dialog" aria-labelledby="vuln-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title" id="vuln-modal-label">Vulnerability Modal</h1>
                <div class="btn-group" role="group" aria-label="Modal top buttons">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
            <div class="modal-body">
            <div class="containier-fluid">
                <!-- VulnID -->
                <div class="row justify-content-start">
                    <div class="col">
                        <p id="vuln-modal-vulnid" hidden>-1</p>
                    </div>
                </div>
                <!-- VulnID end -->
                <!-- Alerts -->
                <div class="row justify-content-start alert alert-success" role="alert" id="vuln-modal-alert-success">
                Vulnerability Assessment successfully updated
                </div>
                <div class="row justify-content-start alert alert-danger" role="alert" id="vuln-modal-alert-danger">
                There was an error processing your request
                </div>
                <div class="row justify-content-start alert alert-warning" role="alert" id="vuln-modal-alert-warning">
                <p id="vuln-modal-alert-warning-item"></p> <button type="button" class="btn btn-success" id="vuln-modal-warning-yes" onclick="placeholder()">Yes</button><button type="button" class="btn btn-danger" id="vuln-modal-warning-no" onclick="placeholder()">No</button>
                </div>
                <!-- Alerts end -->
                <!-- Summary -->
                <div id="vuln-modal-section-summary">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Summary</h3>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-div-summary">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-summary" id="vuln-modal-edit-summary" onclick="showModalEdit(this.id)" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <form id="vuln-modal-form-summary" action="#" method="post">
                            <textarea id="vuln-modal-summary" name="summary" readonly class="form-control-plaintext">Summary goes here</textarea>
                            <button type="submit" class="btn btn-dark vme-btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
                </div>
                <!-- Summary end -->
                <hr>
                <!-- Cve -->
                <div id="vuln-modal-section-cve">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <button type="button" class="btn-sm btn-success vme-btn vme-btn-cve" id="vuln-modal-add-cve" onclick="handleModalAddItem(this.id)" aria-label="Add">
                            <span aria-hidden="true">&plus;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <h3>CVEs</h3>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-div-add-cve">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <form id="vuln-modal-form-add-cve" action="#" method="post">
                            <input type="text" id="vuln-modal-add-cve-text" name="cve" value="">
                            <button type="submit" class="btn btn-dark">Submit</button>
                        </form>
                    </div>
                </div>
                <div id="vuln-modal-cve-list">
                </div>
                </div>
                <!-- Cve end -->
                <hr>
                <!-- Cvss -->
                <div id="vuln-modal-section-cvss">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Cvss</h3>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-div-cvss">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-cvss" id="vuln-modal-edit-cvss" onclick="showModalEdit(this.id)" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <a id="vuln-modal-cvss" href="#">CVSS</a>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-div-edit-cvss">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <form id="vuln-modal-form-cvss" action="#" method="post">
                            <input type="number" step="0.1" id="vuln-modal-cvss-edit" name="cvssScore" value="">
                            <input type="url" id="vuln-modal-cvss-link-edit" name="cvssLink" value="">
                            <button type="submit" class="btn btn-dark">Submit</button>
                        </form>
                    </div>
                </div>
                </div>
                <!-- Cvss end -->
                <hr>
                <!-- Corpscore -->
                <div id="vuln-modal-section-corpscore">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Corporate Risk Score</h3>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-div-corpscore">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-corpscore" id="vuln-modal-edit-corpscore" onclick="showModalEdit(this.id)" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <form id="vuln-modal-form-corpscore" action="#" method="post">
                            <input type="number" step="0.1" id="vuln-modal-corpscore" class="form-control-plaintext" readonly name="corpscore" value="">
                            <button type="submit" class="btn btn-dark vme-btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
                </div>
                <!-- Corpscore end -->
                <hr>
                <!-- Test -->
                <div id="vuln-modal-section-test">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Test to see if system is affected</h3>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-test" id="vuln-modal-edit-test" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <p id="vuln-modal-test">Test goes here</p>
                    </div>
                </div>
                </div>
                <!-- Test end -->
                <hr>
                <!-- Mitigation -->
                <div id="vuln-modal-section-mitigation">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Mitigation steps</h3>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-mitigation" id="vuln-modal-edit-mitigation" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <p id="vuln-modal-mitigation">Mitigation strategy goes here</p>
                    </div>
                </div>
                </div>
                <!-- Mitigation end -->
                <hr>
                <!-- Date Opened -->
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Date VA opened</h3>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <p id="vuln-modal-initiated">Date initiated goes here</p>
                    </div>
                </div>
                <!-- Date Opened end -->
                <hr>
                <!-- Date Closed -->
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3 id="vuln-modal-mitigated-header">Date VA closed</h3>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <p id="vuln-modal-mitigated">Date mitigated goes here</p>
                    </div>
                </div>
                <!-- Date Closed end -->
                <hr>
                <!-- Tickets -->
                <div id="vuln-modal-section-tickets">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>Tickets</h3>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-tickets-list">
                </div>
                </div>
                <!-- Tickets end -->
                <hr>
                <!-- References -->
                <div id="vuln-modal-section-refs">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3>References</h3>
                    </div>
                </div>
                <div class="row justify-content-start" id="vuln-modal-ref-list">
                </div>
                </div>
                <!-- References end -->
                <hr>
                <!-- Exploitable -->
                <div id="vuln-modal-section-exploitable">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h3 id="vuln-modal-exploitable-header">Exploitable</h3>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-exploitable" id="vuln-modal-edit-exploitable" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <p id="vuln-modal-exploitable">Exploitable boolean goes here</p>
                    </div>
                </div>
                </div>
                <!-- Exploitable end -->
                <hr>
                <!-- Exploit -->
                <div id="vuln-modal-section-exploit">
                <div class="row justify-content-start">
                    <div class="col-1">
                        <p></p>
                    </div>
                    <div class="col-11">
                        <h5 id="vuln-modal-exploit-header">Exploit Code</h5>
                    </div>
                </div>
                <div class="row justify-content-start">
                    <div class="col-1">
                        <button type="button" class="btn-sm bg-white text-success border-0 vme-btn vme-btn-exploit" id="vuln-modal-edit-exploit" aria-label="Edit">
                            <span aria-hidden="true">&#9998;</span>
                        </button>
                    </div>
                    <div class="col-11">
                        <pre id="vuln-modal-exploit"><code>Exploit code goes here</code></pre>
                    </div>
                </div>
                </div>
                <!-- Exploit end -->
                <hr>
                <!-- Affected -->
                <div id="vuln-modal-affected" roles="tablist">
                    <div class="card">
                        <div class="card-header" role="tab" id="vuln-modal-affected-header">
                            <h5 class="mb-0">
                                <a data-toggle="collapse" href="#vuln-modal-affected-collapse" aria-expanded="false" aria-controls="vuln-modal-affected-collapse" class="text-dark">
                                    View affected systems
                                </a>
                            </h5>
                        </div>
                        <div id="vuln-modal-affected-collapse" class="collapse" role="tabpanel" aria-labelledby="vuln-modal-affected-header" data-parent="#vuln-modal-affected">
                            <div class="card-body">
                                <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover">
                                    <caption class="lead text-center" style="caption-side:top">Click on a row for options</caption>
                                    <thead>
                                        <tr>
                                            <th scope="col">System Name</th>
                                            <th scope="col">Description</th>
                                            <th scope="col">Location</th>
                                            <th scope="col">State</th>
                                            <th scope="col">Patched</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vuln-modal-affected-table">
                                    </tbody>
                                </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Affected end -->
            </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{{end}}

// Vulnerability Modal For Editing
{{define "vuln-modal-edit"}}
<div class="modal fade" id="vuln-modal-edit" tabindex="-1" role="dialog" aria-labelledby="vuln-modal-label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="vuln-modal-label-edit">Vulnerability Modal</h3>
                <div class="btn-group" role="group" aria-label="Modal top buttons">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
            <div class="modal-body">
            <form>
                <div class="form-group">
                    <label for="vuln-modal-summary-edit">Summary</label>
                    <textarea id="vuln-modal-summary-edit">Summary goes here</textarea>
                </div>
                <div class="form-group">
                    <label for="vuln-modal-cve-list-edit">CVEs</label>
                    <!--
                    <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">CVE-Number-Here</span>
                    </label>
                    -->
                </div>
                <div class="form-group">
                    <label for="vuln-modal-cvss-edit">Cvss</label>
                    <input type="number" id="vuln-modal-cvss-edit" min="0" max="10">0</input>
                    <input type="url" id="vuln-modal-cvss-link-edit">CVSS</input>
                </div>
                <div class="form-group">
                    <label for="vuln-modal-corp-score-edit">Corporate Risk Score</label>
                    <input type="number" id="vuln-modal-corp-score-edit">0</input>
                </div>
                <div class="form-group">
                    <label for="vuln-modal-test-edit">Test to see if system is affected</label>
                    <textarea id="vuln-modal-test-edit" wrap="hard">Test goes here</textarea>
                </div>
                <div class="form-group">
                    <label for="vuln-modal-mitigation-edit">Mitigation steps</label>
                    <textarea id="vuln-modal-mitigation-edit" wrap="hard">Mitigation strategy goes here</textarea>
                </div>
                <div class="form-group">
                    <label for="vuln-modal-initiated-edit">Date VA opened</label>
                    <input type="text" readonly class="form-control-plaintext" id="vuln-modal-initiated-edit" value="Date initiated goes here">
                </div>
                <div class="form-group">
                    <label for="vuln-modal-mitigated-edit" id="vuln-modal-mitigated-header-edit">Date VA closed</label>
                    <input type="text" readonly class="form-control-plaintext"  id="vuln-modal-mitigated-edit" value="Date mitigated goes here">
                </div>
                <div class="form-group">
                    <label for="vuln-modal-tickets-list-edit">Tickets</label>
                    <!--
                    <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">Ticket-Number-Here</span>
                    </label>
                    -->
                </div>
                <div class="form-group">
                    <label for="vuln-modal-ref-list-edit">References</label>
                    <!--
                    <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">References-Here</span>
                    </label>
                    -->
                </div>
                <h5 id="vuln-modal-exploitable-header">Exploitable</h5>
                <p id="vuln-modal-exploitable">Exploitable boolean goes here</p>
                <h5 id="vuln-modal-exploit-header">Exploit Code</h5>
                <pre id="vuln-modal-exploit"><code>Exploit code goes here</code></pre>
                <div id="vuln-modal-affected" roles="tablist">
                    <div class="card">
                        <div class="card-header" role="tab" id="vuln-modal-affected-header">
                            <h5 class="mb-0">
                                <a data-toggle="collapse" href="#vuln-modal-affected-collapse" aria-expanded="false" aria-controls="vuln-modal-affected-collapse" class="text-dark">
                                    View affected systems
                                </a>
                            </h5>
                        </div>
                        <div id="vuln-modal-affected-collapse" class="collapse" role="tabpanel" aria-labelledby="vuln-modal-affected-header" data-parent="#vuln-modal-affected">
                            <div class="card-body">
                                <table class="table table-striped table-bordered table-hover table-responsive">
                                    <thead>
                                        <tr>
                                            <th scope="col">System Name</th>
                                            <th scope="col">Description</th>
                                            <th scope="col">Location</th>
                                            <th scope="col">State</th>
                                            <th scope="col">Patched</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vuln-modal-affected-table">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{{end}}

// Display vulnerability
{{define "vuln-page"}}
{{template "header"}}
{{template "navbar" .U}}
{{if .U.Authed}}
<div class="container">
    <h1 class="text-center">{{.Vuln.Name}}</h1>
</div>
{{end}}
{{template "footer"}}
{{end}}

{% endraw %}
